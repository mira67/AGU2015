<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html>
<!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>AGU [results]</title>

	<meta name="description" content="">
	<meta name="viewport" content="width=device-width">
	<script src="js/jquery-2.1.4.min.js"></script>
	<script src="js/highmaps.js"></script>
	<script src="js/exporting.js"></script>
	<script src="js/antarctica.js"></script>
	<!-- include the jQuery and jQuery UI scripts -->
	<script src="https://code.jquery.com/jquery-2.1.1.js"></script>
	<script src="https://code.jquery.com/ui/1.11.1/jquery-ui.js"></script>
	<script src="js/jquery-ui-slider-pips.js"></script>
	<link rel="stylesheet" href="https://code.jquery.com/ui/1.10.4/themes/flick/jquery-ui.css">
	<!-- plus a jQuery UI theme, here I use "flick" -->
	<link rel="stylesheet" href="css/jquery-ui-slider-pips.css">
	<link rel="stylesheet" href="css/style.css">

	<style type="text/css">
		#content {
			height: 90vh;
		}		
		#sidebar {
			height: 90vh;
		}
		#prevNext {
			float: left;
			margin: auto;
		}
		#pics, #image {
			margin: 0;
			padding: 0;
		}
	</style>
	
</head>
<body id="index" class="home">
	
	<header class='container' id='header'>
		<nav class='container roundEdge' id='nav'>
			<center><h1 id='project'>Anomaly Analysis Results</h1></center>
		</nav>
	</header>
	
	<!--<nav class='container roundEdge' id='nav'>
	</nav>-->

    <section class='container' id='main'>
        <section id='content'>
		
		<!-- height: 632, width: 664 -->
		<div id="pics">
			<img id="image" src="images/jan.png" width="664" height="632" style="border:1px solid black;">
			<canvas id="myCanvas" width="664" height="632" style="border:1px solid black;">
		
			<script> <!-- draw pixels on the canvas -->
			red = 1;
			green = 1;
			blue = 1;
			function invertColor( col ){
				if( col == 1){
					col = 0;
				} else {
					col = 1;
				}
				//$('#myCanvas').load(document.URL + "#myCanvas");
				console.log("colors: " + red + green + blue);
				
				return col;
			}
			document.getElementById("image").onload = function(){
				var c = document.getElementById("myCanvas");
				var ctx = c.getContext("2d");
				var img = document.getElementById("image");
				ctx.drawImage(img, 0, 0);
				var imgData = ctx.getImageData(0, 0, c.width, c.height);
				// change colors
				var i;
				for( i = 0; i < imgData.data.length; i+=4 ){
					if( red == 1 ) { imgData.data[i] = 255 - imgData.data[i]; }
					if( green == 1 ) { imgData.data[i+1] = 255 - imgData.data[i+1]; }
					if( blue == 1 ) { imgData.data[i+2] = 255 - imgData.data[i+2]; }
					imgData.data[i+3] = 255; 
				}
				console.log("image size: " + imgData.data.length);	 
				ctx.putImageData(imgData, 0, 0);
			}
			</script> <!-- end draw on canvas -->
		</div><!-- pics -->

		<div class="slider"></div>

		<div id="changeDateButtons">
			<br><br><br>
			<input class="myButton" value="Query Previous 10 Days" onclick="changeDateRange(-10);" type="button">
			<input class="myButton" value="Query Next 10 Days" onclick="changeDateRange(10);" type="button">			
			<br>			
			<input class="myButton" value="toggle red channel" onclick="red = invertColor(red);" type="button">
			<input class="myButton" value="toggle blue channel" onclick="green = invertColor(green);" type="button">
			<input class="myButton" value="toggle green channel" onclick="blue = invertColor(blue);" type="button">
		</div>

		<script>
			// set up an array to hold the months
			var months = ["jan", "feb", "mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec"];
			// lets be fancy for the demo and select the current month.
			var activeMonth = new Date().getMonth();
		
			function changeDateRange( num ){
				var currentDate = new Date(slideDate.getDate());
				currentDate.setDate;
//console.log("before: " + slideDate);
				slideDate.setDate(currentDate.getTime() + num);
//console.log("after: " + slideDate);
				var newDates = GetDates(slideDate, 10);
console.log("newDates: " + newDates);
				$(".slider")
				.slider({ min: 0, max: 9, value: 1 })
				.slider("pips", { rest: "label", labels: newDates })
			}

			// find the next ten days
			function GetDates(startDate, daysToAdd){
				var arrDates = [];
				for(var i = 0; i <= daysToAdd; i++){
					var currentDate = new Date(startDate);
//console.log(currentDate);
					currentDate.setDate(startDate.getDate() + i);
					arrDates.push(currentDate.getDate() + " " 
						+ MonthAsString(currentDate.getMonth()) + " " 
						+ currentDate.getFullYear());
				}
				return arrDates;
// off by one day???? utc vs mst
			}

			function MonthAsString(monthIndex){
				var d = new Date();
				var month = new Array();
				month[0] = "jan";
				month[1] = "feb";
				month[2] = "mar";
				month[3] = "apr";
				month[4] = "may";
				month[5] = "jun";
				month[6] = "jul";
				month[7] = "aug";
				month[8] = "sep";
				month[9] = "oct";
				month[10] = "nov";
				month[11] = "dec";
				return month[monthIndex];
			}
			
			sDate = JSON.parse(localStorage.userQuery)["sDate"];
console.log("sDate: " + sDate);	
			startDate = new Date(sDate);
			slideDate = startDate;
			var arrDates = GetDates(startDate, 10);
console.log("arrDates" + arrDates);

			$(".slider")
			// activate the slider with options
			.slider({
			    min: 0,
			    max: 9,
			    value: 1
			})

			.slider("pips", {
				rest: "label",
				labels: arrDates
			})

			// and whenever the slider changes, lets echo out the month
			.on("slidechange", function(e, ui) {
				$("#labels-months-output").text("You selected " + months[ui.value] + " (" + ui.value + ")");
				//display corresponding images based on selected date
				$("#image").attr("src", "images/" + months[ui.value] + ".png");
//console.log("images/" + months[ui.value] + ".png");
			});
		</script>
				
		<script>
			window.onload = function() {
				var query = JSON.parse(localStorage["userQuery"]);
				console.log("query results: " + query);
			};
			
			// get all the data
			dataPassed = JSON.parse(localStorage.userQuery);
			dsName = dataPassed["dsName"];
			dsFreq = dataPassed["dsFreq"];
			dsPolar = dataPassed["dsPolar"];
			sDate = dataPassed["sDate"];
			eDate = dataPassed["eDate"];

		</script>
		
		<script>
			var ajaxHandle = $.ajax({
				type : "POST",
				contentType : "application/json; charset=utf-8",
				url : "anomaly/ajaxImutation.do",
				data : JSON.stringify(anomlyRequest),
				dataType : 'jsonp',
				async : false,
				success : function(response) {
					 $("#expDiv").html("Hi")
				}
							
				// finsih update pixels
				var k = 0;
				var foo = [];
		//      testData = [{"date":1350885600000,"val":222.1,"longi":100.0,"lati":100.0},{"date":1375336800000,"val":209.8,"longi":100.0,"lati":100.0},{"date":1375423200000,"val":209.4,"longi":100.0,"lati":100.0},{"date":1375509600000,"val":209.4,"longi":100.0,"lati":100.0},{"date":1375596000000,"val":210.6,"longi":100.0,"lati":100.0},{"date":1375682400000,"val":212.1,"longi":100.0,"lati":100.0}];
				for( k = 0; k <= testData.length; k++ ){
					foo = testData[k];
					var d = new Date(0); // set date to epoch
					d.setUTCSeconds(foo["date"]);
					val = foo["val"];
					longi = foo["longi"];
					lati = foo["lati"];

					var c = document.getElementById("myCanvas");
					var ctx = c.getContext("2d");
					var img = document.getElementById("image");
					ctx.drawImage(img, 0, 0);
					var imgData = ctx.getImageData(0, 0, c.width, c.height);

					var indice = longi * c.width + lati;
					
					for(k = 0; k < 1000; k++){
					indice = k;
					imgData.data[indice] = 255;
					imgData.data[indice+1] = 255;
					imgData.data[indice+2] = 0;
					imgData.data[indice+3] = 0; 

					console.log("image size: " + imgData.data.length);	 
					console.log(longi + lati);
					ctx.putImageData(imgData, 0, 0);
					}
				}

				
				
			});
			

	
		</script>
	</section>

        <aside id="sidebar" class="roundEdge">
		<br>
		<img src="images/jan.png" alt="logo" style="width:200px;height:200px;">
		<p>January</p>
		<img src="images/feb.png" alt="logo" style="width:200px;height:200px;">
		<p>February</p>
		<img src="images/mar.png" alt="logo" style="width:200px;height:200px;">
		<p>March</p>
	</aside>
    	</section>

	<footer class='container' id='footer'>
		<center><p>Â© 2015 NSIDC & University of Colorado at Boulder</p></center>
	</footer>
</body>
</html>

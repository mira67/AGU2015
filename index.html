<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> 
<html> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>AGU2015</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">

	<script src="js/jquery-2.1.4.min.js"></script>
	<script src="js/highmaps.js"></script>
	<script src="js/exporting.js"></script>
	<script src="js/antarctica.js"></script>
    <script src="js/proj4.js"></script>
	
	<link rel="stylesheet" href="css/style.css"  />

</head>
<body id="index" class="home">
	
	<header class='container' id='header'>
	<!--<img src="css/img/logo_nsidc.jpg"> </img>-->
	<h1 id='project' class='center'>Condensing Massive Satellite Datasets For Rapid Interactive Analysis</h1>
	</header>
	
	<!--<nav class='container roundEdge' id='nav'>

	</nav>-->
	
	<section class='container' id='main'>
		<section id='content'>
	<div id = 'map'>
	<script>
	$(function () {

     var H = Highcharts,
        map = H.maps['custom/antarctica'],
        chart;
    var data_anomaly = [
        {
            name: 'Anomaly 1',
            lat: -83.12,
            lon: 43.41
        }
    ]; 

    var data_hc = [
        {
            "hc-key": "aq-3638",
            "value": 0
        },
        {
            "hc-key": "aq-3639",
            "value": 1
        },
    ]; 

    // Initiate the chart
    $('#map').highcharts('Map', {

        title : {
            text : 'Antarctica'
        },

        subtitle : {
            text : 'Source map: <a href="js/antarctica.js">Antarctica</a>'
        },

        mapNavigation: {
            enabled: true,
            buttonOptions: {
                verticalAlign: 'bottom'
            }
        },

        colorAxis: {
            min: 0
        },

        tooltip: {
            formatter: function () {
                    return this.point.name + '<br>Lat: ' + this.point.lat + ' Lon: ' + this.point.lon;
                },
                crosshairs: [{
                    zIndex: 5,
                    dashStyle: 'dot',
                    snap: false,
                    color: 'gray'
                }, {
                    zIndex: 5,
                    dashStyle: 'dot',
                    snap: false,
                    color: 'gray'
                }]
            },

        series : [{
            data : data_hc,
            mapData: map,
            //joinBy: 'hc-key',
            name: 'Test',
            showInLegend: false,
            states: {
                hover: {
                    color: '#BADA55'
                }
            },
            dataLabels: {
                enabled: true,
                format: '{point.name}'
            }
        },
        {
                type: 'mapbubble',
                dataLabels: {
                    enabled: true,
                    format: '{point.name}'
                },
                name: 'Anomaly',
                data: data_anomaly,
                maxSize: '10%',
                color: H.getOptions().colors[0]
            }   
        ]
    });

chart = $('#map').highcharts();

    // Display custom label with lat/lon next to crosshairs
    $('#map').mousemove(function (e) {
        var position;

        if (chart) {
            if (!chart.lab) {
                chart.lab = chart.renderer.text('', 0, 0)
                    .attr({
                        zIndex: 5
                    })
                    .css({
                        color: '#505050'
                    })
                    .add();
            }

            e = chart.pointer.normalize(e);
            position = chart.fromPointToLatLon({
                x: chart.xAxis[0].toValue(e.chartX),
                y: chart.yAxis[0].toValue(e.chartY)
            });

            chart.lab.attr({
                x: e.chartX + 5,
                y: e.chartY - 22,
                text: 'Lat: ' + position.lat.toFixed(2) + '<br>Lon: ' + position.lon.toFixed(2)
            });
        }
    });

    $('#map').mouseout(function () {
        if (chart && chart.lab) {
            chart.lab.destroy();
            chart.lab = null;
        }
    });
});

//user specified region
initDraw(document.getElementById('map'));
function initDraw(canvas) {
    function setMousePosition(e) {
        var ev = e || window.event; //Moz || IE
        if (ev.pageX) { //Moz
            mouse.x = ev.pageX + window.pageXOffset;
            mouse.y = ev.pageY + window.pageYOffset;
        } else if (ev.clientX) { //IE
            mouse.x = ev.clientX + document.body.scrollLeft;
            mouse.y = ev.clientY + document.body.scrollTop;
        }
    };

    var mouse = {
        x: 0,
        y: 0,
        startX: 0,
        startY: 0
    };
    var element = null;

    canvas.onmousemove = function (e) {
        setMousePosition();
        if (element !== null) {
            element.style.width = Math.abs(mouse.x - mouse.startX) + 'px';
            element.style.height = Math.abs(mouse.y - mouse.startY) + 'px';
            element.style.left = (mouse.x - mouse.startX < 0) ? mouse.x + 'px' : mouse.startX + 'px';
            element.style.top = (mouse.y - mouse.startY < 0) ? mouse.y + 'px' : mouse.startY + 'px';
        }
    }

    canvas.onclick = function (e) {
        if (element !== null) {
            element = null;
            canvas.style.cursor = "default";
            console.log("finsihed.");
        } else {
            console.log("begun.");
            mouse.startX = mouse.x;
            mouse.startY = mouse.y;
            element = document.createElement('div');
            element.className = 'rectangle'
            element.style.left = mouse.x + 'px';
            element.style.top = mouse.y + 'px';
            canvas.appendChild(element)
            canvas.style.cursor = "crosshair";
        }
    }
}

</script>
		</div>	
		</section>
		
		<aside id='sidebar' class='roundEdge'> 
			
			
		</aside>
	</section>
	
	<footer class='container' id='footer'>
		<p>
		Â© 2015 NSIDC & University of Colorado at Boulder
		</p>
	</footer>
	
	
</body>
</html>
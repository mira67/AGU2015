<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>timeline testing</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    
    <script src="https://code.jquery.com/jquery-2.1.4.js"></script>
    <script src="https://code.jquery.com/ui/1.11.1/jquery-ui.js"></script>
    <script src="js/jquery-ui-slider-pips.js"></script>
	
	<link rel="stylesheet" href="css/jquery-ui-slider-pips.css">
	<link rel="stylesheet" href="https://code.jquery.com/ui/1.10.4/themes/flick/jquery-ui.css">

	<script type="text/javascript">
		

	</script>
	
	<style type="text/css">
		* {
			box-sizing: border-box;
		}
		body {
			font-family: 'Roboto', 'Helvetica', 'Arial', 'Sans Serif';
			max-width: 100%;
			overflow-x: hidden;
			background: url('images/snow2.jpg') no-repeat center center fixed;
			-webkit-background-size: cover;
			-moz-background-size: cover;
			-o-background-size: cover;
			background-size: cover;
			margin: 0; padding: 0;
		}
		.background {
			position: fixed;
			top: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0, 0, 0, 0.5);
		}
		.options {
			float: left;
			top: 0;
			bottom: 0;
			width: 25vw;
			height: 100%;
		}
		.results {
			float: right;
			top: 0;
			bottom: 0;
			width: 48vw;
			height: 100%;
		}
		p {
			color: #fff;
			font-size: 1em;
			text-align: left;
			margin-bottom: 5px;
		}
		.row {
			width: 100%;
			position: relative;
			float: left;
			display: inline-block;
			text-align: center;
		}
		.slide {
			margin: 0 2% 0 2%;
		}
		.btn {
			display: inline-block;
			border-radius: 5px;
			border: none;
			height: 30px;
			padding: 0;
			margin-bottom: 5px;
			font-size: 1em;
			letter-spacing: 3px;
		}
		.sm { width: 19%; }
		.thr { width: 32%; }
		.md { width: 48%; }
		.lg { width: 98%; }
		.ghost {
			background-color: rgba(255, 255, 255, 0.4);
			color: #222;
			border: 1px solid #aaa;  
			transition: .5s ease;
		}
		.ghost:hover {
			transition-property: font-size;
			transition-duration: 1s;
			background-color: #ddd;
			font-size: 1.2em;
			transition-duration: 0.5s;
		}
		.ghost:active {
			color: #fff;
			transition-property: font-size;
			transition-duration: 0.3s;
			background-color: #222;
			/*font-size: 1.1em;*/
			transition-duration: 0.3s;
		}
	</style>
	
</head>
<!-- ///////////////////////////////////////////////////////////////////////////////////////// -->
<body>
<div class="background"></div>
<div id="wrapper">
<div class="options">

	<!--
	<div class="row"><p>SSMI - Projection: EPSG:3031</p></div>
	-->
	
	<div class="row"><p>Frequency</p></div>	
	<div class="row">
		<div class="mutual">
			19<input id="chk19" name="chk19" type="checkbox" value="19" class="checkbox">
			22<input id="chk22" name="chk22" type="checkbox" value="22" class="checkbox">
			37<input id="chk37" name="chk37" type="checkbox" value="37" class="checkbox" checked>
			85<input id="chk85" name="chk85" type="checkbox" value="85" class="checkbox">
			91<input id="chk91" name="chk91" type="checkbox" value="91" class="checkbox">
		</div>
	</div>
	
	<div class="row"><p>Polarization</p></div>
	<div class="row">
		<div class="mutual">
			vertical<input id="chkVertical" name="chkVertical" type="checkbox" value="vertical" class="checkbox" checked>
			horizontal<input id="chkHorizontal" name="chkHorizontal" type="checkbox" value="horizontal" class="checkbox">
		</div>
	</div>

	<div class="row"><p>Timeline Zoom</p></div>
	<div class="row">
		<div class="mutual">
			days<input id="chkDay" name="chkDay" type="checkbox" value="vertical" class="checkbox">
			months<input id="chkMonth" name="chkHorizontal" type="checkbox" value="horizontal" class="checkbox">
			years<input id="chkYear" name="chkHorizontal" type="checkbox" value="horizontal" class="checkbox" checked>
		</div>
	</div>
	
	<div class="row">
	</div>
	
	<div class="row"><p>Layer Opacity</p><p id="layerOpacityText"></p></div>
	<div class="row">
		<div class="slide sliderLayerOpacity"></div>
	</div>
	
	<div class="row"><p>Marker Opacity</p><p id="markerOpacityText"></p></div>
		<div class="row">
		<div class="slide sliderMarkerOpacity"></div>
	</div>

	<div class="row"><p>Years</p><p id="yearsText"></p></div>
		<div class="row">
		<div class="slide sliderYears"></div>
	</div>

	<div class="row"><p>Pattern</p><p id="patternText"></p></div>
		<div class="row">
		<div class="slide sliderPattern"></div>
	</div>

	<div class="row"><p>Submit Query</p></div>
	
	<!-- old code
	<input class="myButton" value="Submit Query" onclick="sendRequest(anomalyRequest,0);" type="button">
	-->
	<div class="row">
		<button class="btn lg ghost" onclick="sendRequest(anomalyRequest, 0);">submit query</button>
	</div>
	
</div>

<div class="results">
	<div class="row"><p>Results:</p></div>
	<div class="row">
		<div id="outputResults"></div>
	</div>
</div>

<div>
	<div class="row"><p>Timeline</p><p id="timelineText"></p></div>
		<div class="row">
		<div class="slide sliderTimeline"></div>
	</div>
</div>

<!-- ///////////////////////////////////////////////////////////////////////////////////////// -->

<script type="text/javascript">

	var months = ["jan", "feb", "mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec"];
	var dataSet = "SSMI";
	var frequency = "19";
	var polarization = "h";
	var startDate = "2010-12-12";
	var endDate = "2010-12-20";

	// bounding box for request
	var loctnArray = Array();
	loctnArray[0] = { "longitude": -39.3, "latitude": -42.5 };
	loctnArray[1] = { "longitude": -41.4, "latitude": 136 };
	
	var startYear = 1987; // set up as the same for the slider
	var endYear = 2014;
	var startMonth = 0;
	var endMonth = 11;

	anomalyRequest = {
		"dsName": dataSet,
		"dsFreq": frequency,
		"dsPolar": polarization,
		"sDate": startDate,
		"eDate": endDate,
		"locations": loctnArray
	};

	// variables that control the timelilne view -- start zoomed to years
	var minYear = 1987;
	var maxYear = 2014;
	var sliderTimelineMin = minYear;
	var sliderTimelineMax = maxYear;
	var sliderTimelineStep = 1;
	var sliderTimelineValue = 1;
	var timelineZoomLevel = "day";

	$('button').click(function () {
		$(this).css('border', '5px solid #444');
		$(this).css('background', '#eee');
	});
	
	// http://jsfiddle.net/3TssG/
	$('.mutual .checkbox').click( function( ){
		var checkedState = $(this).prop("checked")
			$(this)
				.parent('div')
				.children('.checkbox:checked')
				.prop("checked", false);
		$(this).prop("checked", checkedState);
		$( updateResults( anomalyRequest ) );
		$( updateDateValues() );
	});	

	// change opacity of the layer
	$(".sliderLayerOpacity")
    .slider({
		min: 0,
        max: 1,
		step: 0.05,
		value: 0.5,
		slide: function( event, ui ){
			$("#layerOpacityText").text( ui.value );
		},
		change: function( event, ui ){
			$("#layerOpacityText").text( ui.value );
		}
    })
    .slider("pips", {
        rest: "label",
		step: 5
    })
	.on("slidechange", function( event, ui ){
		$("#layerOpacityText").text( ui.value );
		$( updateResults( anomalyRequest ) );
    });

	// change opacity of the markers
	$(".sliderMarkerOpacity")
    .slider({
		min: 0,
        max: 1,
		step: 0.05,
		value: 0.5,
		slide: function( event, ui ){
			$("#markerOpacityText").text( ui.value );
		},
		change: function( event, ui ){
			$("#markerOpacityText").text( ui.value );
		}
    })
    .slider("pips", {
        rest: "label",
		step: 5
    })
	.on("slidechange", function( event, ui ){
		$("#markerOpacityText").text( ui.value );
		$( updateResults( anomalyRequest ) );
    });
	
	// user input of the date
	$(".sliderYears")
		.slider({
			min: minYear,
			max: maxYear,
			range: true,
			step: 1,
			values: [2009, 2011],
			//this gets a live reading of the value and prints it on the page
			slide: function( event, ui ){
				$("#yearsText").text( ui.values[0] + " to " + ui.values[1] );
			},
			change: function( event, ui ){
				$("#yearsText").text( ui.values[0] + " to " + ui.values[1] );
			}
		})
		.slider("pips", {
			rest: "label",
			step: 3
		})
		.on("slidechange", function( event, ui ){
			$("#yearsText").text( ui.values[0] + " to " + ui.values[1] );
			$( updateResults( anomalyRequest ) );
    });

	$(".sliderPattern")
		.slider({ 
			min: 0, 
			max: months.length-1,
			range: true,
			values: [0, 11],
			slide: function( event, ui ){
				$("#patternText").text( months[ui.values[0]] + " to " + months[ui.values[1]] );
			},
			change: function( event, ui ){
				$("#patternText").text( months[ui.values[0]] + " to " + months[ui.values[1]] );
			}

		})
		.slider("pips", {
			rest: "label",
			labels: months
		})
		.on("slidechange", function( event ,ui ){
			$("#patternText").text( months[ui.values[0]] + " to " + months[ui.values[1]] );
			$( updateResults( anomalyRequest ) );
    });

	$(".sliderTimeline")
		.slider({ 
			min: sliderTimelineMin,
			max: sliderTimelineMax,
			step: sliderTimelineStep,
			values: [sliderTimelineMin, sliderTimelineMax],
			slide: function( event, ui ){
				$("#timelineText").text( ui.value );
			},
			change: function( event, ui ){
				$("#timelineText").text( ui.value );
			}
		})
		.slider("pips", {
			rest: "label",
			step: 1
		})
		.on("slidechange", function( event ,ui ){
			$("#timelineText").text( ui.value );
			$( updateResults( anomalyRequest ) );
    });

	function updateResults( anomalyRequest ){
	
		// determine frequency
		if( $("#chk19").is(':checked') ){
			frequency = "19";
		} else if( $("#chk22").is(':checked') ){
			frequency = "22";
		} else if( $("#chk37").is(':checked') ){
			frequency = "37";
		} else if( $("#chk85").is(':checked') ){
			frequency = "85";
		} else if( $("#chk91").is(':checked') ){
			frequency = "91";
		} else {
			frequency = "19";
		}
		
		// determine polarization
		if( $("#chkVertical").is(':checked') ){
			polarization = "v";
		} else if( $("#chkHorizontal").is(':checked') ){
			polarization = "h";
		} else {
			polarization = "v";
		}
		
		// determine timeline zoom
		if( $("#chkDay").is(':checked') ){
			timelineZoomLevel = "day";
		} else if( $("#chkMonth").is(':checked') ){
			timelineZoomLevel = "month";
		} else if( $("#chkYear").is(':checked') ){
			timelineZoomLevel = "year";
		} else {
			timelineZoomLevel = "day";
		}
		
		startYear = $(".sliderYears").slider("values")[0];
		endYear = $(".sliderYears").slider("values")[1];
		startMonth = $(".sliderPattern").slider("values")[0] + 1;
		endMonth = $(".sliderPattern").slider("values")[1] + 1;
		
		startDate = startYear + "-" + ("00" + startMonth).slice(-2) + "-01";
		endDate = endYear + "-" + ("00" + startMonth).slice(-2) + "-01";

		document.getElementById("outputResults").innerHTML =
					
			"<p>" + dataSet + ", " + frequency + ", " + polarization + ", " + startDate + ", " + endDate + "</p>"
			+ "<p>timeline zoom: " + timelineZoomLevel + "</p>"
			+ "<p>layer opacity: " + $(".sliderLayerOpacity").slider("value") + "</p>"
			+ "<p>marker opacity: " + $(".sliderMarkerOpacity").slider("value") + "</p>"
			+ "<p>slider years: " + startYear + ", " + endYear + "</p>"
			+ "<p>slider pattern: " + months[$(".sliderPattern").slider("values")[0]] + " to " + months[$(".sliderPattern").slider("values")[1]] + "</p>"
			+ "<p>dates: " + startDate + ", " + endDate + "</p>"
			+ "<p>location array: " + loctnArray[0] + ", " + loctnArray[1] + "</p>";
		
		// update anomaly request values
		anomalyRequest["dsName"] = dataSet;
		anomalyRequest["dsFreq"] = "s" + frequency + polarization;
		anomalyRequest["dsPolar"] = polarization;
		anomalyRequest["sDate"] = startDate;
		anomalyRequest["eDate"] = endDate;
		anomalyRequest["locations"] = loctnArray
	}	

	function updateDateValues() {

		
		if( $("#chkMonth").is(':checked') ){
			// months
			$(".sliderTimeline")
			.slider({
				min: 0,
				max: 11,
				step: 1,
				value: 0
			}).slider("pips", {
				rest: "label",
				labels: months
			});
		} else if( $("#chkYear").is(':checked') ){
			// years
			$(".sliderTimeline")
			.slider({
				min: minYear,
				max: maxYear,
				step: 1,
				value: 0
			}).slider("pips", {
				rest: "label",
				step: 1
			});
		} else {
			// days
			$(".sliderTimeline")
			.slider({
				min: 0,
				max: 31,
				step: 1,
				value: 0
			}).slider("pips", {
				rest: "label",
				step: 1
			});
		}
	}

	function sendRequest( anomalyRequest, mode ){
	
		anomalyRequest["dsName"] = dataSet;
		anomalyRequest["dsFreq"] = "s" + frequency + polarization;
		anomalyRequest["dsPolar"] = polarization;
		anomalyRequest["sDate"] = startDate;
		anomalyRequest["eDate"] = endDate;
		anomalyRequest["locations"] = loctnArray
		
		console.log("anomalyRequest" + anomalyRequest);
		localStorage['userQuery'] = JSON.stringify(anomalyRequest);
		console.log("localStorage: " + localStorage['userQuery']);
		
		updateDateValues();
		
		parseRequest();
		//parseRequest(); //send and parse results
		//updateDateValues(); //first 10 days from user query
	};

	requestReturned = 0;	
	function parseRequest( e ){
		console.log("making request....");

		ajaxHandle = $.ajax({
			type : "POST",
			contentType : "application/json; charset=utf-8",
			url : "./anomaly/ajaxRetrvAnomaly.do",
			data : localStorage["userQuery"],
			dataType : 'json',
			async : true,
			success : function(response) {
				console.log("ajax success!________________ajax success!");
				console.log("respones: " + response);
				//anomalyRequest = response;
				requestReturned = 1;
				updatePixels();
			}
		});
	}


	updateResults(anomalyRequest);
</script>

</body>
</html>
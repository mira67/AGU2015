<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>AGU 2015</title>
<script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="http://openlayers.org/en/v3.10.1/css/ol.css" type="text/css">
<script src="http://openlayers.org/en/v3.10.1/build/ol.js"></script>

</head>
<body>
<div class="container-fluid">

<div class="row-fluid">
  <div class="span12">
    <div id="map" class="map"></div>
  </div>
</div>

</div>
<script>
	Proj4js.defs("EPSG:4326", "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs");
	Proj4js.defs("EPSG:3031", "+proj=stere +lat_0=-90 +lat_ts=-71 +lon_0=0 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs");
	Proj4js.defs("EPSG:900913", "+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs");

	var projection = new ol.proj.Projection({
	  code: 'EPSG:3031',
	  extent: [-3000000,-3000000,3000000,3000000]
	});
	
	var map = new ol.Map({
		target: 'map',
		view: new ol.View({
			center: [0, 0],
			zoom: 13
		}),
		projection: "EPSG:3031",
		displayProjection: "EPSG:4326"
	});
		
	
	var features = new ol.Collection();
	var featureOverlay = new ol.layer.Vector({
	  source: new ol.source.Vector({features: features}),
	  style: new ol.style.Style({
		fill: new ol.style.Fill({
		  color: 'rgba(255, 255, 255, 0.2)'
		}),
		stroke: new ol.style.Stroke({
		  color: '#ffcc33',
		  width: 2
		}),
		image: new ol.style.Circle({
		  radius: 7,
		  fill: new ol.style.Fill({
			color: '#ffcc33'
		  })
		})
	  })
	});
	featureOverlay.setMap(map);

	var modify = new ol.interaction.Modify({
	  features: features,
	  // the SHIFT key must be pressed to delete vertices, so
	  // that new vertices can be drawn at the same position
	  // of existing vertices
	  deleteCondition: function(event) {
		return ol.events.condition.shiftKeyOnly(event) &&
			ol.events.condition.singleClick(event);
	  }
	});
	map.addInteraction(modify);

	
	var draw; // global so we can remove it later
	function addInteraction() {
	  draw = new ol.interaction.Draw({
		features: features,
		type: /** @type {ol.geom.GeometryType} */ (typeSelect.value)
	  });
	  map.addInteraction(draw);
	}

	var typeSelect = document.getElementById('type');

	/**
	 * Let user change the geometry type.
	 * @param {Event} e Change event.
	 */
	typeSelect.onchange = function(e) {
	  map.removeInteraction(draw);
	  addInteraction();
	};

	addInteraction();

	
	var tiles = new ol.Layer.XYZ(
		'Polar XYZ',
		'http://polar.openstreetmap.de/tiles/${z}/${x}/${y}.png',
		{
			projection: 'EPSG:3031',
			maxExtent: [-3000000,-3000000,3000000,3000000],
			attribution: 'Â© <a href="http://www.openstreetmap.org/">OpenStreetMap</a>contributors',
			numZoomLevels: 20,
			transitionEffect: 'resize'
		}
	)
	map.addLayer(tiles);

</script>

</body>
</html>
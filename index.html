<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>AGU2015</title>
    <!--<meta name="viewport" content="width=device-width, initial-scale=1.0">-->
    <!-- openlayers needs to compile sooner or error is raised -->
    <script language="javascript" type="text/javascript" src="js/jquery-2.1.4.min.js"></script>
    <script language="javascript" type="text/javascript" src="js/jquery-confirm.min.js"></script>
    <script language="javascript" type="text/javascript" src="js/ol.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="css/jquery-confirm.min.css">
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
	
	
<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/proj4js/1.1.0/proj4js-compressed.js"></script>
<!--
<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/openlayers/2.12/OpenLayers.js"></script>
-->
	
    <style type="text/css">
		#content {
			height: 90vh;
		}
		#sidebar {
			height: 90vh;
		}
		/* start css for maps */
		#map {
			height: 100%;
			width: 100%;
			margin: 0px;
			padding: 0px;
			background: #000;
		}
		.olImageLoadError {
			display: none !important;
		}
		#map .olControlAttribution {
			right: 2px;
			bottom: 2px;
			color: #ccc;
			font-family: arial;
		}
		#map .olControlAttribution a {
			color: #ffc;
		}
		/* end css for maps */
		body {
			background-image: url("images/background.jpg");
		}
		/*
		#drawElements {
			outline: 2px solid black;
		}
		*/
    </style>

	<script>
	
	//Make sure your bounding box interaction variable is global
	var boundingBox;

<!-- end box drag -->
	
    function setupmap() {
		Proj4js.defs["EPSG:4326"] = "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs";
		Proj4js.defs["EPSG:3031"] = "+proj=stere +lat_0=-90 +lat_ts=-71 +lon_0=0 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs";
		Proj4js.defs["EPSG:900913"] = "+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs";

		var map = new ol.Map('map', {
			controls: [
				new ol.Control.Navigation(),
				new ol.Control.PanZoomBar(),
				new ol.Control.Attribution(),
				new ol.Control.LayerSwitcher(),
				new ol.Control.ScaleLine(),
				new ol.Control.Permalink({
					anchor: true
				})
			],
			projection: "EPSG:3031",
			displayProjection: "EPSG:4326"
		});

		var lonlat = new ol.LonLat(-1.788, 53.571).transform(
			new ol.Projection("EPSG:4326"), // transform from WGS 1984
			new ol.Projection("EPSG:900913") // to Spherical Mercator
		);
		
		<!-- -->
		
		var tiles = new ol.Layer.XYZ(
			'Polar XYZ',
			'http://polar.openstreetmap.de/tiles/${z}/${x}/${y}.png',
			{
				projection: 'EPSG:3031',
				maxExtent: [-3000000,-3000000,3000000,3000000],
				attribution: 'Â© <a href="http://www.openstreetmap.org/">OpenStreetMap</a> contributors',
				numZoomLevels: 20,
				transitionEffect: 'resize'
			}
		)
		map.addLayer(tiles);

	
		var markers = new OpenLayers.Layer.Vector("Markers", {
			projection: 'EPSG:4326',
			strategies: [new OpenLayers.Strategy.Fixed()],
				protocol: new OpenLayers.Protocol.HTTP({
				url: "interesting.json",
				format: new OpenLayers.Format.GeoJSON()
			})
		});
		map.addLayer(markers);
	
		var featctl = new OpenLayers.Control.SelectFeature(markers);
		map.addControl(featctl);
		featctl.activate();

		featctl.events.register('featurehighlighted', this, function(e) {
			var pt = e.feature.geometry, ll = new OpenLayers.LonLat(pt.x, pt.y);

			map.setCenter(ll, 11);
		});

		map.events.register('zoomend', this, function() {
			markers.setVisibility(map.zoom < 8);
		});

		if(!map.getCenter())
			map.setCenter(new OpenLayers.LonLat(0, 0)/* despite the class name, these are in EPSG:3031, so 0/0 is actually the pole */, 1);
		
    }

	<!-- --                 --->
	
	//Place this after your map is instantiated
	boundingBox = new ol.interaction.DragBox({
		condition: ol.events.condition.always,
		style: new ol.style.Style({
			stroke: new ol.style.Stroke({
				color: [0,0,255,1]
			})
		})
	});

	map.addInteraction(boundingBox);

	map.on('boxend', function(e){
		map.removeInteraction(boundingBox);
		
		catchments_url = 'http://felek.cns.umass.edu:8080/geoserver/Streams/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=Streams%3ANHD_Local&outputformat=json&bbox=' + boundingBox.getGeometry().getExtent();

		$.getJSON(catchments_url, function(d) {
			var vectorSource = new ol.source.GeoJSON(
				/** @type {olx.source.GeoJSONOptions} */( {
				object : d
			}
			));

			wfs_layer = new ol.layer.Vector({
				source : vectorSource,
				style : function(feature, resolution) {
					var text = resolution < 5000 ? feature.get('name') : '';
					if (!styleCache[text]) {
						styleCache[text] = [new ol.style.Style({
							fill : new ol.style.Fill({
								color : 'rgba(255, 255, 255, 0.1)'
							}),
							stroke : new ol.style.Stroke({
								color : '#319FD3',
								width : 1
							}),
							text : new ol.style.Text({
								font : '12px Calibri,sans-serif',
								text : text,
								fill : new ol.style.Fill({
									color : '#000'
								}),
								stroke : new ol.style.Stroke({
									color : '#fff',
									width : 3
								})
							}),
							zIndex : 999
						})];
					}
					return styleCache[text];
				}
			});

			map.addLayer(wfs_layer);
	})
	})
	
	
    </script>
<!--  ///////////////////////////////////////////////////// -->	
	<script>
		function toggleControl(element) {
			for(key in drawControls) {
				var control = drawControls[key];
				if(element.value == key && element.checked) {
					control.activate();
				} else {
					control.deactivate();
				}
			}
		}

		function allowPan(element) {
			var stop = !element.checked;
			for(var key in drawControls) {
				drawControls[key].handler.stopDown = stop;
				drawControls[key].handler.stopUp = stop;
			}
		}
	</script>
<!--  ///////////////////////////////////////////////////// -->	
    <script>

    /*User Request Configuration*/
    var sendString = "",
        dataSet = "SSMI",
        frequency = "19",
        polarization = "h",
        startDate = "2012-08-08",
        endDate = "2012-08-10";

    var loctnArray = Array();

    /*user request function*/
    var anomalyRequest = {
        "dsName": dataSet,
        "dsFreq": frequency,
        "dsPolar": polarization,
        "sDate": startDate,
        "eDate": endDate,
        "locations": loctnArray
    };

    function updateDate() {
        startDate = "" + document.getElementById('startDate').value;
        endDate = "" + document.getElementById('endDate').value;
        anomalyRequest["sDate"] = startDate;
        anomalyRequest["eDate"] = endDate;
    }

    function changeDataSet(ds) {
        dataSet = ds;
        updateDate();
        //update dataSet
        anomalyRequest["dsName"] = ds;

        if (ds == "AVHRR") {
            document.getElementById("dataset1").style.color = "black";
            document.getElementById("dataset2").style.color = "#B6B6B4";
        } else {
            document.getElementById("dataset2").style.color = "black";
            document.getElementById("dataset1").style.color = "#B6B6B4";
        }
    };

    function changeFrequency(freq) {
        frequency = freq;
        updateDate();
        //update Frequency
        anomalyRequest["dsFreq"] = freq;

        if (freq == '91') {
            document.getElementById("freq91").style.color = "black";
            document.getElementById("freq85").style.color = "#B6B6B4";
            document.getElementById("freq37").style.color = "#B6B6B4";
            document.getElementById("freq22").style.color = "#B6B6B4";
            document.getElementById("freq19").style.color = "#B6B6B4";
        } else if (freq == '85') {

            document.getElementById("freq91").style.color = "#B6B6B4";
            document.getElementById("freq85").style.color = "black";
            document.getElementById("freq37").style.color = "#B6B6B4";
            document.getElementById("freq22").style.color = "#B6B6B4";
            document.getElementById("freq19").style.color = "#B6B6B4";
        } else if (freq == '37') {
            document.getElementById("freq91").style.color = "#B6B6B4";
            document.getElementById("freq85").style.color = "#B6B6B4";
            document.getElementById("freq37").style.color = "black";
            document.getElementById("freq22").style.color = "#B6B6B4";
            document.getElementById("freq19").style.color = "#B6B6B4";
        } else if (freq == '22') {
            document.getElementById("freq91").style.color = "#B6B6B4";
            document.getElementById("freq85").style.color = "#B6B6B4";
            document.getElementById("freq37").style.color = "#B6B6B4";
            document.getElementById("freq22").style.color = "black";
            document.getElementById("freq19").style.color = "#B6B6B4";
        } else {
            document.getElementById("freq91").style.color = "#B6B6B4";
            document.getElementById("freq85").style.color = "#B6B6B4";
            document.getElementById("freq37").style.color = "#B6B6B4";
            document.getElementById("freq22").style.color = "#B6B6B4";
            document.getElementById("freq19").style.color = "black";
        }
    };

    function changePolarization(pol) {
        polarization = pol;
        updateDate();
        anomalyRequest["dsPolar"] = pol;

        if (pol == 'v') {
            document.getElementById("vertical").style.color = "black";
            document.getElementById("horizontal").style.color = "#B6B6B4";
        } else {
            document.getElementById("horizontal").style.color = "black";
            document.getElementById("vertical").style.color = "#B6B6B4";
        }
    }

    //function updatePolyArea(pa) { polyArea = pa; }
    function enablePolygonSearch() {};

    //pass full request to a new page, in localStorage
    function sendRequest(anomalyRequest) {
        updateDate();
        anomalyRequest["dsFreq"] = 's' + frequency + polarization;
        //transfer request to result page
        localStorage['userQuery'] = JSON.stringify(anomalyRequest);
        var win = window.open("anomaly.html",'_blank');
        win.focus();
    };
    </script>
</head>

<body id="index" class="home" onload="setupmap()">
    <header class='container' id='header'>
    </header>
    <nav class='container roundEdge' id='nav'>
        <h1 id='project' class='center'>NSIDC - Condensing Massive Satellite Datasets For Rapid Interactive Analysis</h1>
    </nav>
    <section class='container' id='main'>
        <div id='content'>
            <div id='map'>
				<div class="time">Last Update (of all Tiles): 21.10.2015 20:22:44</div>
            </div>
        </div>
        <aside id='sidebar' class='roundEdge'>
            <br>
            <span id="datasetName"><font color="Black">Data Set</font></span>
            <br>
            <button id="dataset2" class="myButton" onclick="changeDataSet('SSMI')">SSMI</button>
            <br>
            <span id="datasetFrequency"><font color="Black">Frequency [ SSMI ]</font></span>
            <br>
            <button id="freq91" class="myButton" onclick="changeFrequency('91')">91.7</button>
            <button id="freq85" class="myButton" onclick="changeFrequency('85')">85.5</button>
            <button id="freq37" class="myButton" onclick="changeFrequency('37')">37.0</button>
            <button id="freq22" class="myButton" onclick="changeFrequency('22')">22.2</button>
            <button id="freq19" class="myButton" onclick="changeFrequency('19')">19.3</button>
            <br>
            <span id="datasetFrequency"><font color="Black">Polarization [ SSMI ]</font></span>
            <br>
            <button id="vertical" class="myButton" onclick="changePolarization('v')">vertical</button>
            <button id="horizontal" class="myButton" onclick="changePolarization('h')">horizontal</button>
            <br>
            <span id="datasetField"><font color="Black">Start Date</font></span>
            <br>
            <input id="startDate" name="startDate" value="2012-08-08" type="date" min="1987-01-01" max="2014-12-31" onclick="updateDate()" />
            <br>
            <span id="datasetField"><font color="Black">End Date</font></span>
            <br>
            <input id="endDate" name="endDate" value="2012-08-20" type="date" min="1987-01-01" max="2014-12-31" onclick="updateDate()" />
            <br>
            <!--
			<span id="datasetField"><font color="Black">Search Polygon Location</font></span>
			<br><br>
			<button id="searchButtonToggle" class="myButton" onclick="enablePolygonSearch()"><strike>| Enable |</strike></button>
		-->
            <br>
            <div class="geospatialInputFieldsNsew" id="spatialInput_nsew">
                <input class="myButton" value="Reset Map &amp; Selection" onclick="searchMapObject.resetMap();" type="button">
                <br>
                <br>
                <span class="northInput">N <input id="nsew_northId" size="7" value="90.00" onchange="searchMapObject.changeLatLonBoundary('north', this.value, 'search');" type="text"></span>
                <br>
                <br>
                <span class="westInput">W <input id="nsew_westId" size="7" value="-180.00" onchange="searchMapObject.changeLatLonBoundary('west', this.value, 'search');" type="text"></span>
                <span class="eastInput"> E <input id="nsew_eastId" size="7" value="180.00" onchange="searchMapObject.changeLatLonBoundary('east',this.value, 'search');" type="text"></span>
                <br>
                <br>
                <span class="southInput">S <input id="nsew_southId" size="7" value="-90.00" onchange="searchMapObject.changeLatLonBoundary('south',this.value, 'search');" type="text"></span>
            </div>

            <br>
			<hr />
			<div id="drawElements">
				<div id="bbox_drag_instruction">Drag a box:</div>
				<div id="bbox_adjust_instruction">Adjust the box ...or
				<br>
				<input type="button" value="drag new box" onclick="dragNewBox();"></div>
				<br>
				<p id="bbox_result"></p>
			</div> <!-- end drawElements -->
			<hr />
			
			<input class="myButton" value="Submit Query" onclick="sendRequest(anomalyRequest);" type="button">
		</aside>
    </section>
    <footer class='container' id='footer'>
        <p>Â© 2015 NSIDC & University of Colorado at Boulder</p>
    </footer>
</body>

</html>


<!--
Resources:

	SSMI Page:
	<http://nsidc.org/data/docs/daac/nsidc0001_ssmi_tbs.gd.html>

	<http://dev.openlayers.org/examples/draw-feature.html>
	<http://harrywood.co.uk/maps/examples/openlayers/bbox-selector.view.html>



-->
